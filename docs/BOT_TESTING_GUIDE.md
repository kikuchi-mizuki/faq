# Bot動作確認ガイド

## 🎯 概要

認証システムが実装されたLINE Botの動作確認手順です。

## 🚀 確認手順

### **STEP1: Railwayでの動作確認**

#### **1.1 ログの確認**

Railwayダッシュボードで以下のメッセージを確認：

```
✅ 認証システム用スプレッドシートの自動作成が完了しました！
📊 作成されたシート:
  - store_management (店舗管理)
  - staff_management (スタッフ管理)
🧪 認証システムが利用可能になりました
```

#### **1.2 ヘルスチェック**

```bash
curl https://your-app.railway.app/healthz
```

期待される応答：
```json
{
  "status": "healthy",
  "timestamp": "2025-01-13T10:00:00Z",
  "services": {
    "qa_service": "active",
    "auth_service": "active",
    "store_service": "active",
    "staff_service": "active"
  }
}
```

#### **1.3 統計情報の確認**

```bash
curl https://your-app.railway.app/admin/stats
```

期待される応答：
```json
{
  "total_qa_items": 10,
  "total_flows": 5,
  "total_stores": 3,
  "total_staff": 4,
  "auth_enabled": true,
  "last_updated": "2025-01-13T10:00:00Z"
}
```

### **STEP2: LINE Botの動作確認**

#### **2.1 未認証ユーザーのテスト**

1. **LINE Botにメッセージを送信**
   - 任意のメッセージを送信

2. **期待される応答**
   ```
   このBotは関係者専用です。

   スタッフの方は「認証」と入力して認証を行ってください。
   不明な点は管理者にお問い合わせください。
   ```

#### **2.2 認証フローのテスト**

1. **認証開始**
   - 「認証」と入力

2. **期待される応答**
   ```
   Botをご利用いただくには認証が必要です。

   「認証する」ボタンを押してLINEログインしてください。
   ```

3. **認証ボタンの表示**
   - 「認証する」ボタンが表示されることを確認

4. **店舗コード入力**
   - 「店舗コード:STORE001」と入力

5. **期待される応答**
   ```
   店舗コードを入力してください。

   例：店舗コード:A123
   ```

6. **社員番号入力**
   - 「社員番号:001」と入力

7. **期待される応答**
   ```
   社員番号を入力してください。

   例：社員番号:001
   ```

8. **認証成功**
   - 認証成功メッセージが表示されることを確認

#### **2.3 認証済みユーザーのテスト**

1. **Q&A検索のテスト**
   - 「修正は何回まで可能ですか？」と入力
   - 適切な回答が返されることを確認

2. **分岐会話のテスト**
   - 「月次締め」と入力
   - 分岐会話が開始されることを確認

3. **通常のBot機能のテスト**
   - 各種質問に対して適切な回答が返されることを確認

### **STEP3: エラーケースのテスト**

#### **3.1 認証失敗のテスト**

1. **存在しない店舗コード**
   - 「店舗コード:INVALID」と入力
   - エラーメッセージが表示されることを確認

2. **存在しない社員番号**
   - 「社員番号:999」と入力
   - エラーメッセージが表示されることを確認

3. **認証試行回数制限**
   - 3回連続で認証に失敗
   - 認証が一時的に無効化されることを確認

#### **3.2 権限のテスト**

1. **停止中の店舗**
   - STORE003（suspended）で認証を試行
   - 認証が失敗することを確認

2. **停止中のスタッフ**
   - 停止中のスタッフで認証を試行
   - 認証が失敗することを確認

### **STEP4: パフォーマンステスト**

#### **4.1 応答時間の確認**

1. **認証フローの応答時間**
   - 各ステップで2秒以内に応答することを確認

2. **Q&A検索の応答時間**
   - 質問に対して2秒以内に回答することを確認

#### **4.2 同時接続のテスト**

1. **複数ユーザーの同時認証**
   - 複数のユーザーが同時に認証を試行
   - 正常に処理されることを確認

2. **認証済みユーザーの同時利用**
   - 複数の認証済みユーザーが同時にBotを利用
   - 正常に処理されることを確認

## 🔧 トラブルシューティング

### **よくある問題**

#### **1. 認証が失敗する**
- 店舗コードと社員番号が正しいか確認
- スタッフのステータスが「active」か確認
- 店舗のステータスが「active」か確認

#### **2. Botが応答しない**
- Railwayのログでエラーが発生していないか確認
- 環境変数が正しく設定されているか確認

#### **3. スプレッドシートにアクセスできない**
- Google Sheets APIの権限設定を確認
- サービスアカウントの設定を確認

### **ログの確認方法**

1. **Railwayダッシュボード**
   - プロジェクトを選択
   - 「Deployments」タブをクリック
   - ログを確認

2. **重要なログメッセージ**
   ```
   ✅ 認証システム用スプレッドシートの自動作成が完了しました
   ✅ 店舗データを読み込みました: 3件
   ✅ スタッフデータを読み込みました: 4件
   ✅ 認証が完了しました
   ```

## 📊 確認完了チェックリスト

- [ ] Railwayのログでスプレッドシート作成が成功
- [ ] ヘルスチェックが正常に応答
- [ ] 統計情報が正しく表示
- [ ] 未認証ユーザーに制限メッセージが表示
- [ ] 認証フローが正常に動作
- [ ] 認証済みユーザーがBotを利用可能
- [ ] Q&A検索が正常に動作
- [ ] 分岐会話が正常に動作
- [ ] エラーケースが適切に処理
- [ ] 応答時間が2秒以内

## 🎯 次のステップ

動作確認が完了したら：

1. **ユーザーガイドの作成**
2. **管理者ガイドの作成**
3. **運用開始の準備**
4. **スタッフへの案内**

---

## 🎉 完了！

Botの動作確認が完了したら、フランチャイズ店舗のスタッフが安全にBotを利用できるようになります！
