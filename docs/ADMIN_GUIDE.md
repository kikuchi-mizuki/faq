# 管理者ガイド

## 🎯 概要

認証システムの管理者向け運用ガイドです。

## 🚀 管理機能

### **店舗管理**

#### **店舗の追加**
1. Googleスプレッドシートの「store_management」シートを開く
2. 新しい行を追加
3. 以下の情報を入力：
   - `store_code`: 店舗コード（例：STORE004）
   - `store_name`: 店舗名（例：池袋店）
   - `status`: ステータス（active/suspended/expired）
   - `created_at`: 作成日時（自動）
   - `notes`: 備考
   - `contact_info`: 連絡先情報
   - `location`: 店舗所在地
   - `manager_name`: 店舗責任者名

#### **店舗の編集**
1. 対象の店舗の行を選択
2. 必要な情報を更新
3. 変更を保存

#### **店舗の停止**
1. `status`を「suspended」に変更
2. `admin_notes`に停止理由を記録
3. 変更を保存

### **スタッフ管理**

#### **スタッフの追加**
1. Googleスプレッドシートの「staff_management」シートを開く
2. 新しい行を追加
3. 以下の情報を入力：
   - `store_code`: 店舗コード
   - `staff_id`: 社員番号
   - `staff_name`: スタッフ名
   - `position`: 役職
   - `status`: ステータス（active/suspended/inactive）
   - `created_at`: 作成日時（自動）
   - `notes`: 備考

#### **スタッフの編集**
1. 対象のスタッフの行を選択
2. 必要な情報を更新
3. 変更を保存

#### **スタッフの停止**
1. `status`を「suspended」に変更
2. `notes`に停止理由を記録
3. 変更を保存

### **認証管理**

#### **認証情報のリセット**
1. 対象のスタッフの行を選択
2. `line_user_id`を空にする
3. `auth_time`を空にする
4. 変更を保存

#### **認証状態の確認**
1. `line_user_id`が設定されているか確認
2. `auth_time`が最近の日時か確認
3. `last_activity`で最終利用日時を確認

## 📊 統計情報の確認

### **Railwayダッシュボード**
1. プロジェクトを選択
2. 「Deployments」タブをクリック
3. ログで統計情報を確認

### **API経由での確認**
```bash
# 統計情報を取得
curl https://your-app.railway.app/admin/stats
```

期待される応答：
```json
{
  "total_qa_items": 10,
  "total_flows": 5,
  "total_stores": 3,
  "total_staff": 4,
  "auth_enabled": true,
  "last_updated": "2025-01-13T10:00:00Z"
}
```

## 🔧 トラブルシューティング

### **よくある問題**

#### **1. 認証が失敗する**
**原因**: 店舗・スタッフ情報の不整合
**解決方法**:
- 店舗コードが正しいか確認
- 社員番号が正しいか確認
- ステータスが「active」か確認

#### **2. Botが応答しない**
**原因**: システムエラー
**解決方法**:
- Railwayのログを確認
- 環境変数の設定を確認
- システムの再起動

#### **3. スプレッドシートにアクセスできない**
**原因**: Google Sheets APIの権限問題
**解決方法**:
- サービスアカウントの権限を確認
- スプレッドシートの共有設定を確認

### **ログの確認方法**

#### **Railwayダッシュボード**
1. プロジェクトを選択
2. 「Deployments」タブをクリック
3. ログを確認

#### **重要なログメッセージ**
```
✅ 認証システム用スプレッドシートの自動作成が完了しました
✅ 店舗データを読み込みました: 3件
✅ スタッフデータを読み込みました: 4件
✅ 認証が完了しました
```

#### **エラーログの例**
```
❌ 店舗データの読み込みに失敗しました
❌ スタッフデータの読み込みに失敗しました
❌ 認証に失敗しました
```

## 📋 運用チェックリスト

### **日次チェック**
- [ ] システムが正常に動作しているか
- [ ] ログにエラーが発生していないか
- [ ] 認証統計が正常か

### **週次チェック**
- [ ] 店舗・スタッフ情報の更新
- [ ] 認証失敗の分析
- [ ] システムパフォーマンスの確認

### **月次チェック**
- [ ] 店舗・スタッフ情報の見直し
- [ ] 認証統計の分析
- [ ] システムの最適化

## 🎯 運用のベストプラクティス

### **店舗・スタッフ情報の管理**
1. **定期的な更新**
   - 新規店舗・スタッフの追加
   - 退職・異動スタッフの削除
   - 情報の更新

2. **ステータス管理**
   - アクティブな店舗・スタッフの管理
   - 停止中の店舗・スタッフの管理
   - 期限切れの店舗・スタッフの管理

### **セキュリティ管理**
1. **認証情報の管理**
   - 不正な認証の監視
   - 認証失敗の分析
   - セキュリティインシデントの対応

2. **アクセス制御**
   - 関係者のみアクセス可能
   - 認証状態の管理
   - セッション管理

### **パフォーマンス管理**
1. **応答時間の監視**
   - 認証フローの応答時間
   - Q&A検索の応答時間
   - システム全体のパフォーマンス

2. **リソース管理**
   - メモリ使用量の監視
   - CPU使用率の監視
   - データベースの最適化

## 📞 サポート

### **技術的な問題**
- システムエラーの対応
- パフォーマンス問題の解決
- セキュリティインシデントの対応

### **運用に関する問題**
- 店舗・スタッフ情報の管理
- 認証システムの運用
- ユーザーサポート

## 🎉 運用開始

認証システムの運用が開始されました！

### **最初に確認すべき項目**
1. 店舗・スタッフ情報が正しく設定されているか
2. 認証システムが正常に動作しているか
3. 統計情報が正しく表示されているか
4. ログにエラーが発生していないか

---

## 📋 まとめ

この認証システムは、フランチャイズ店舗のスタッフのみがLINE Botを利用できる安全なシステムです。

- 🔐 認証システムによるアクセス制御
- 🏪 店舗・スタッフ情報の一元管理
- 📊 統計情報による運用監視
- 🔧 管理者による柔軟な運用管理

安全で効率的なBot運用を実現できます！
